[TOC]

## Redis存储大key有什么优化的解决方案

1. 应用层对存储的数据进行压缩，在存储到Redis中，从Redis中获取数据后在解压数据。

2. 可以拆分存储内容，将大key中的存储信息进行拆分。例如一个存储一个很大的对象，可以将对象的方法和属性给拆分开进行存储，这样检索的时候也会很快。也可以采用数据切片处理。

3. 制定合理的内存淘汰策略，例如lru、lfu等内存淘汰策略方案。

4. 上面几种方案如不能解决，也可以使用集群、扩容等操作。进行横向扩展。

5. 选择一个合理的数据类型，可以针对数据做多级缓存，上级缓存存储一些基本的必要字段，下级缓存可以存储一些部分场景必要的字段。

> 针对大key，一般会出现两种情况。一种是数据检索慢，另外一种是内存占用大。因此优化的策略可以从这两个方面入手。

## Redis的数据过期策略有哪些?

过期策略是指数据在过期之后，还会占用这内容，这时候Redis是如何处理的？分别有下面三种方式:

1. 定期检测，Redis在对设置了过期时间的key，在创建时都会增加一个定时器。定时器定时去处理该key。

2. 定时检测，Redis会定期去检测设置了过期时间的key，当该key已经失效了，则会从内存中剔除。

3. 读取检测，在客户端向Redis读数据时，Redis会检测该key是否过期，过期了就返回空值。

[参考文章](https://mp.weixin.qq.com/s/v7zv4PvjyYjtcLJt9CTtkw)

## Redis有哪些数据淘汰策略？

淘汰策略主要是真针对数据一直存在内存中，导致内存无法接纳新的数据。重点是了解lru算法、lfu算法。

1. `volatile-lru`当内存不足以容纳新写入数据时，在设置了过期时间的键空间中，移除最近最少使用的key。

2. `allkeys-lru`当内存不足以容纳新写入数据时，在键空间中，移除最近最少使用的key（这个是最常用的）。

3. `volatile-lfu`当内存不足以容纳新写入数据时，在过期密集的键中，使用LFU算法进行删除key。

4. `allkeys-lfu`当内存不足以容纳新写入数据时，使用LFU算法移除所有的key。

5. `volatile-random`当内存不足以容纳新写入数据时，在设置了过期的键中，随机删除一个key。

6. `allkeys-random`当内存不足以容纳新写入数据时，随机删除一个或者多个key。

7. `volatile-ttl`当内存不足以容纳新写入数据时，在设置了过期时间的键空间中，有更早过期时间的key优先移除。

8. `noeviction`当内存不足以容纳新写入数据时，新写入操作会报错。(默认的方式)

## 什么是缓存穿透、雪崩、击穿，如该如何解决这几个问题？

1. 缓存穿透是指，请求数据库或者缓存都不存在的数据，导致每一个请求都访问数据库。
  1.1 可以针对请求参数过滤，减少无效的请求。
  1.2 将缓存内容设置为null，并制定一个合理的过期时间。
  1.3 第2点中的方案会浪费无效的内存，可以使用[布隆过滤器](https://oss.redislabs.com/redisbloom/)解决。[示例方案](https://mp.weixin.qq.com/s/6rK72BoiNGbto8WIeLQuoA)

2. 缓存击穿是指，请求`某一个热点数据`不存在，导致大量请求访问数据库。
  2.1 设置数据缓存时间永不过期，可以根据物理过期时间和逻辑过期时间来控制。
  2.2 可以将热点数据通过多种方式缓存，Redis不存在还可以通过其他的缓存方式读取。

3. 缓存雪崩是指，`某一个时刻`请求的缓存大面积失效，导致大量请求访问数据库。有可能是缓存过期时间设置比较集中导致。
  3.1 将缓存的时间均匀分布，避免缓存时间过于集中。
  3.2 针对热点数据可以不用设置过期时间，可以根据物理过期时间和逻辑过期时间来控制。
  3.3 多级缓存，一级缓存和二级缓存都设置不同的缓存时间。

## 什么是缓存预热，如何做缓存预热，什么是服务降级，如何做服务降级?

缓存预热是指系统上线后，提前将相关的缓存数据加载到缓存系统。避免在用户请求的时候，先查询数据库，然后再将数据缓存的问题，用户直接查询事先被预热的缓存数据。如果不进行预热，那么Redis初始状态数据为空，系统上线初期，对于高并发的流量，都会访问到数据库中， 对数据库造成流量的压力。

1. 数据量不大的时候，工程启动的时候进行加载缓存动作。

2. 数据量大的时候，设置一个定时任务脚本，进行缓存的刷新。

3. 数据量太大的时候，优先保证热点数据进行提前加载到缓存。

缓存降级是指缓存失效或缓存服务器挂掉的情况下，不去访问数据库，直接返回默认数据或访问服务的内存数据。降级一般是有损的操作，所以尽量减少降级对于业务的影响程度。在项目实战中通常会将部分热点数据缓存到服务的内存中，这样一旦缓存出现异常，可以直接使用服务的内存数据，从而避免数据库遭受巨大压力。